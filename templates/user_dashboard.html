{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>

    <script src={% static '/js/bootstrap.min.js' %}></script>
    <script src={% static '/js/jquery-3.7.0.min.js' %}></script>

    <link href='{% static '/css/bootstrap.min.css' %}' rel="stylesheet">
    <link href='{% static '/css/animate.css' %}' rel="stylesheet">
    <link href='{% static '/font-awesome/css/font-awesome.css' %}' rel="stylesheet">
    <link href='{% static 'css/aqua.min.css' %}' rel="stylesheet">
    {#    <link href='{% static 'css/dashboard.css' %}' rel="stylesheet">#}

    <style>
        .top-menu .btn {
            margin-bottom: 5px;
            float: right;
        }

        .menu-content {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: #f8f9fa;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            display: none;
        }

        .dragStart {
            width: 95% !important;
        }

        .todo {
            min-height: 770px;
            display: flex;
        }

        .todo-column {
            min-height: fit-content;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            align-content: flex-start;
        }

        .back-defined {
            background-color: #EF476F;
        }

        .back-progress {
            background-color: #FFD166;
        }

        .back-complete {
            background-color: #06D6A0;
        }

        .back-fun {
            background-color: white;
        }

        .back-low {
            background-color: lightblue;
        }

        .back-middle {
            background-color: orange;
        }

        .back-emergency {
            background-color: darkred;
        }

        .back-gift {
            background-color: green;
        }

        .dis-hide {
            display: none;
        }

        .dis-show {
            display: block;
        }

        #comment-submit-button {
            height: 55px;
            width: 175px;
            margin-top: 5px;
        }

        #gift-display {
            height: fit-content;
            margin-top: 30px;
        }

        #todo-display {
            margin-top: 30px;
        }

        .row-field {
            margin-top: 5px;
            margin-bottom: 5px;
            height: fit-content !important;
            border-radius: 5px;
        }
    </style>
</head>
<body>
{#navbar menu#}
<ul class="nav">
    <li class="nav-item" style="margin-left: 60px"><a class="nav-link" id="todo-btn">ToDo</a></li>
    <li class="nav-item"><a class="nav-link" id="gift-btn">Gifts</a></li>
    <li class="nav-item"><a class="nav-link" id="report-btn">Reports</a></li>
    <li class="nav-item align-self-center" style="position:absolute; right: 103px">
        <div class="play-pause">
            <button id="playButton" class="btn btn-success" style="display: none;"><i class="fa fa-play"></i></button>
            <button id="pauseButton" class="btn btn-primary"><i class="fa fa-pause"></i></button>
        </div>
    </li>
    <li class="nav-item" style="position: absolute; right: 5px">
        <a class="nav-link" href="/logout/">
            Logout
        </a>
    </li>
</ul>

<div class="container">
    <div class="row">
        <div id="todo-display" class="dis-hide">
            {# todo #}
            <div class="row">
                <div class="todo" id="todo">
                    <div id="todoIncomplete" ondrop="dropInComplete(event)" ondragover="dragoverInComplete(event)"
                         class="todo-column back-defined col-3">

                    </div>
                    <div id="todoProgress" ondrop="dropProgress(event)" ondragover="dragoverProgress(event)"
                         class="todo-column back-progress col-3 offset-1">

                    </div>
                    <div id="todoComplete" ondrop="dropComplete(event)" ondragover="dragoverComplete(event)"
                         class="todo-column back-complete col-3 offset-1">

                    </div>
                </div>
            </div>
            {# comment #}
            <div class="row">
                <div id="comment" class="comment dis-hide col-11 align-items-center">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Comments</h5>
                        </div>
                        <div class="card-body">

                        </div>
                        <div class="card-footer">
                            <form method="post">
                                {% csrf_token %}
                                <div class="form-group">
                                    <label for="comment-text">Add a comment:</label>
                                    <textarea class="form-control" id="comment-text" rows="3" required
                                              name="comment-text"></textarea>
                                </div>
                                <button id="comment-submit-button" type="submit" class="btn btn-primary"><i
                                        class="fa fa-comment"></i> Submit
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div id="gift-display" class="dis-hide">
            {# gift #}
            <div id="gift-self">
                <h2 class="offset-1 col-10">Self gifts:</h2>

            </div>
            <div id="gift-all">
                <h2 class="offset-1 col-10">All gifts:</h2>

            </div>
        </div>
    </div>
</div>

{#notification#}
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"></path>
    </symbol>
    <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path>
    </symbol>
    <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"></path>
    </symbol>
</svg>
<div class="dis-hide">
    <div class="alert alert-primary d-flex align-items-center alert-dismissible" role="alert">
        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Info:">
            <use xlink:href="#info-fill"></use>
        </svg>
        <div>
            An example alert with an icon
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="alert alert-success d-flex align-items-center alert-dismissible" role="alert">
        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:">
            <use xlink:href="#check-circle-fill"></use>
        </svg>
        <div>
            An example success alert with an icon
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="alert alert-warning d-flex align-items-center alert-dismissible" role="alert">
        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Warning:">
            <use xlink:href="#exclamation-triangle-fill"></use>
        </svg>
        <div>
            An example warning alert with an icon
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="alert alert-danger d-flex align-items-center alert-dismissible" role="alert">
        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:">
            <use xlink:href="#exclamation-triangle-fill"></use>
        </svg>
        <div>
            An example danger alert with an icon
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
</div>

<script>
    class Menu {
        constructor(elm) {
            this.elm_persecutor = elm.querySelector('.persecutor');
            this.elm_options = elm.querySelector('.options');
            this.elms_option = elm.querySelectorAll('.options li');
            this.option = null;

            this.elms_option.forEach((elm, idx) => elm.addEventListener('click', this.persecute.bind(this, idx)));
            this.persecute(0);
        }

        persecute(idx, evt) {
            console.log('persecute', this.option, idx, this.option !== idx);
            if (this.option !== idx) requestAnimationFrame(() => {
                const elm_target = this.elms_option[idx];
                const w = this.elm_options.offsetWidth;
                const x1 = elm_target.offsetLeft;
                const x2 = w - x1 - elm_target.offsetWidth;
                console.log(x1, x2);
                const goL = this.option !== null && this.option > idx;
                const goR = this.option !== null && this.option < idx;
                console.log(goL, goR);
                this.option = idx;
                if (goR) this.elm_persecutor.style.transition = 'left 375ms ease-in, right 375ms ease-out';
                if (goL) this.elm_persecutor.style.transition = 'right 375ms ease-in, left 375ms ease-out';
                this.elm_persecutor.style.left = x1 + 'px';
                this.elm_persecutor.style.right = x2 + 'px';
            });
        }
    }

    window.addEventListener('load', () => {
        document.querySelectorAll('.menu').forEach(elm => new Menu(elm));
    });

    function performAjaxRequest(url, data, onSuccess) {
        $.ajax({
            url: url,
            data: data,
            success: function (data, textStatus, jqXHR) {
                onSuccess(data);
                console.log(data);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.warn("Error");
            }
        });
    }

    performAjaxRequest('/usefulness/')

    const incomplete = $('#todoIncomplete')
    const progress = $('#todoProgress')
    const complete = $('#todoComplete')
    var list = {}

    {% for todo in todo %}
        {% if todo.stage == 'd' %}
            {% if todo.type == 'f' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-fun" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% elif todo.type == 'l' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-low" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% elif todo.type == 'm' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-middle" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% elif todo.type == 'e' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-emergency" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% endif %}
            list["todo_{{ todo.id }}"] = todo_{{ todo.id }}
            incomplete.append(todo_{{ todo.id }});
        {% endif %}
    {% endfor %}
    {% for todo in todo %}
        {% if todo.stage == 'p' %}
            {% if todo.type == 'f' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-fun" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% elif todo.type == 'l' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-low" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% elif todo.type == 'm' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-middle" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% elif todo.type == 'e' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-emergency" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% endif %}
            list["todo_{{ todo.id }}"] = todo_{{ todo.id }}
            progress.append(todo_{{ todo.id }});
        {% endif %}
    {% endfor %}
    {% for todo in todo %}
        {% if todo.stage == 'c' %}
            {% if todo.type == 'f' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-fun" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% elif todo.type == 'l' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-low" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% elif todo.type == 'm' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-middle" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% elif todo.type == 'e' %}
                const todo_{{ todo.id }} = `
                    <div data-id={{ todo.id }} class="dragStart row-field back-emergency" draggable="true">
                        <div class="container">
                            <div class="row">
                                <h2> {{ todo.title }} </h2>
                            </div>
                            <div class="row">
                                <p> {{ todo.description }} </p>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12"
                                    onclick="commentOnClick({{ todo.id }})">
                                        <i class="fa fa-comment"></i>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button data-id={{ todo.id }} class="btn btn-success col-12 playTaskButton" onclick="playTaskButton({{ todo.id }})" style="display: none;"><i class="fa fa-play"></i></button>
                                    <button data-id={{ todo.id }} class="btn btn-primary col-12 pauseTaskButton" onclick="pauseTaskButton({{ todo.id }})"><i class="fa fa-pause"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            {% endif %}
            list["todo_{{ todo.id }}"] = todo_{{ todo.id }}
            complete.append(todo_{{ todo.id }});
        {% endif %}
    {% endfor %}

    const giftSelf = $('#gift-self')
    const giftAll = $('#gift-all')


    {% for index in gift %}
        {% if index.user == false %}
            giftSelf.append(`
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-10">
                            <div class="back-gift row-field">
                                <div class="container">
                                    <h2>{{ index.title }}</h2>
                                    <p>{{ index.description }} </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `)
        {% elif index.user != false %}
            giftAll.append(`
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-10">
                            <div class="back-gift row-field">
                                <div class="container">
                                    <h2>{{ index.title }}</h2>
                                    <p>{{ index.description }} </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `)
        {% endif %}
    {% endfor %}

    function dragoverInComplete(ev) {
        ev.preventDefault()
        console.log('dragoverInComplete done!')
    }

    function dragoverProgress(ev) {
        ev.preventDefault()
        console.log('dragoverProgress done!')
    }

    function dragoverComplete(ev) {
        ev.preventDefault()
        console.log('dragoverComplete done!')
    }

    function dropInComplete(ev) {
        ev.preventDefault()
        let ajax_data;
        const id = ev.dataTransfer.getData('id');

        {#$.ajax({#}
        {#    url: "/drop_management",#}
        {#    data: {#}
        {#        id: id,#}
        {#        position: 'd'#}
        {#    },#}
        {#    success: function (data, textStatus, jqXHR) {#}
        {#        ajax_data = data#}
        {#        console.log(data);#}
        {#    },#}
        {#    error: function (jqXHR, textStatus, errorThrown) {#}
        {#        console.warn("Error");#}
        {#    }#}
        {# })#}

        {#if (ajax_data) {#}
        {#    $('#' + id).remove()#}
        {#    var inco = list['todo_' + id]#}
        {#    incomplete.append(inco);#}
        {#    $('.dragStart').on('dragstart', function (ev) {#}
        {#        var id = $(this).attr('data-id')#}
        {#        console.log('start and id = ', id)#}
        {#        ev.originalEvent.dataTransfer.setData('id', id)#}
        {#    });#}
        {# }#}
        $('[data-id=' + id + ']').remove()
        const inco = list['todo_' + id];
        incomplete.append(inco);
        $('.dragStart').on('dragstart', function (ev) {
            const id = $(this).attr('data-id');
            console.log('start and id = ', id)
            ev.originalEvent.dataTransfer.setData('id', id)
        });
        console.log('dropInComplete drop!', id)
    }

    function dropProgress(ev) {
        ev.preventDefault()
        let ajax_data;
        const id = ev.dataTransfer.getData('id');
        {#$.ajax({#}
        {#    url: "/drop_management",#}
        {#    data: {#}
        {#        id: id,#}
        {#        position: 'p'#}
        {#    },#}
        {#    success: function (data, textStatus, jqXHR) {#}
        {#        ajax_data = data#}
        {#        console.log(data);#}
        {#        if (ajax_data) {#}
        {#            $('#' + id).remove()#}
        {#            var inco = list['todo_' + id]#}
        {#            progress.append(inco);#}
        {#            $('.dragStart').on('dragstart', function (ev) {#}
        {#                var id = $(this).attr('data-id')#}
        {#                console.log('start and id = ', id)#}
        {#                ev.originalEvent.dataTransfer.setData('id', id)#}
        {#            });#}
        {#        }#}
        {#    },#}
        {#    error: function (jqXHR, textStatus, errorThrown) {#}
        {#        console.warn("Error");#}
        {#    }#}
        {# }) #}
        $('[data-id=' + id + ']').remove()
        const inco = list['todo_' + id];
        progress.append(inco);
        $('.dragStart').on('dragstart', function (ev) {
            var id = $(this).attr('data-id')
            console.log('start and id = ', id)
            ev.originalEvent.dataTransfer.setData('id', id)
        });
        console.log('dropProgress drop!')
    }

    function dropComplete(ev) {
        ev.preventDefault()
        let ajax_data;
        const id = ev.dataTransfer.getData('id');
        {#$.ajax({#}
        {#    url: "/drop_management",#}
        {#    data: {#}
        {#        id: id,#}
        {#        position: 'c'#}
        {#    },#}
        {#    success: function (data, textStatus, jqXHR) {#}
        {#        ajax_data = data#}
        {#        console.log(data);#}
        {#        if (ajax_data) {#}
        {#            $('#' + id).remove()#}
        {#            var inco = list['todo_' + id]#}
        {#            complete.append(inco);#}
        {#            $('.dragStart').on('dragstart', function (ev) {#}
        {#                var id = $(this).attr('data-id')#}
        {#                console.log('start and id = ', id)#}
        {#                ev.originalEvent.dataTransfer.setData('id', id)#}
        {#            });#}
        {#        }#}
        {#    },#}
        {#    error: function (jqXHR, textStatus, errorThrown) {#}
        {#        console.warn("Error");#}
        {#    }#}
        {# }) #}

        $('[data-id=' + id + ']').remove()
        const inco = list['todo_' + id];
        complete.append(inco);
        $('.dragStart').on('dragstart', function (ev) {
            const id = $(this).attr('data-id');
            console.log('start and id = ', id)
            ev.originalEvent.dataTransfer.setData('id', id)
        });
        console.log('dropComplete drop!', ev)
    }

    $('.dragStart').on('dragstart', function (ev) {
        const id = $(this).attr('data-id');
        console.log('start and id = ', id)
        ev.originalEvent.dataTransfer.setData('id', id)
    });

    $('#todo-btn').on('click', function () {
        $('#todo-display').toggleClass('dis-hide')
    })

    $('#gift-btn').on('click', function () {
        $('#gift-display').toggleClass('dis-hide')
    })

    const list_author = [],
        list_text = [],
        list_timestamp = [];
    let idGetBack;

    function commentOnClick(id) {
        idGetBack = id
        console.log('get data id: ', id)
        $.ajax({
            url: "/open_comments",
            data: {
                id: id
            },
            success: function (data, textStatus, jqXHR) {
                console.log(data);
                var author, text, time;
                if ($('#comment').hasClass('dis-hide')) {
                    $('#comment').removeClass('dis-hide')
                    for (let i = 0; i < data.length; i++) {
                        author = data[i].author
                        text = data[i].text
                        time = data[i].timestamp
                        $('.card-body').append(`
                        <div class="media">
                            <div class="media-body">
                                <h6 class="mt-0">` + author + `</h6>
                                <p>` + text + `</p>
                                <span class="text-muted"><i class="far fa-clock"></i> ` + time + ` </span>
                            </div>
                            <hr>
                        </div>
                    `)
                    }
                    console.log('if is true')
                } else if (!$('#comment').hasClass('dis-hide')) {
                    $('.media').remove()
                    $('#comment').addClass('dis-hide')
                    console.log('if is false')
                } else {
                    console.warn("Error");
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.warn("Error");
            }
        })
    }

    $('#comment-submit-button').on('click', function () {
        console.log('get data id: ', idGetBack)
        event.preventDefault()
        var text = $('#comment-text').val()
        $('#comment-text').val('')
        $.ajax({
            url: "/add_comment",
            data: {
                text: text,
                id: idGetBack
            },
            success: function (data, textStatus, jqXHR) {
                console.log(data);
                var author = data.author
                var text = data.text
                var time = data.time
                $('.card-body').append(`
                    <div class="media">
                        <div class="media-body">
                            <h6 class="mt-0">` + author + `</h6>
                            <p>` + text + `</p>
                            <span class="text-muted"><i class="far fa-clock"></i> ` + time + ` </span>
                        </div>
                        <hr>
                    </div>
                `)
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.warn("Error");
            }
        })
    })

    const playButton = $("#playButton");
    const pauseButton = $("#pauseButton");

    {% if pause.end_time == false and pause.start_time %}
        pauseButton.hide();
        playButton.show();
    {% endif %}

    playButton.on("click", function play() {
        performAjaxRequest("/continue_activity", {}, function (data) {
            if (data === 'Play') {
                playButton.hide();
                pauseButton.show();
            }
        });
    });

    pauseButton.on("click", function pause() {
        performAjaxRequest("/pause_activity", {}, function (data) {
            if (data === 'Pause') {
                pauseButton.hide();
                playButton.show();
            }
        });
    });

    // Task play/pause activity
    $(".pauseTaskButton").each(function (i, button) {
        performAjaxRequest("/task_pause_check", {id: $(button).data('id')}, function (data) {
            if (data === 'Play') {
                $(button).hide();
                $(".playTaskButton").eq(i).show();
            }
        });
    });

    function playTaskButton(id) {
        const playTaskButtonSelector = $(`.playTaskButton[data-id="` + id + `"]`);
        const pauseTaskButtonSelector = $(`.pauseTaskButton[data-id="` + id + `"]`);

        performAjaxRequest("/continue_task_activity", {id: id}, function (data) {
            if (data === 'Play') {
                playTaskButtonSelector.hide();
                pauseTaskButtonSelector.show();
            }
        });
    }

    function pauseTaskButton(id) {
        const button = $(".pauseTaskButton[data-id='" + id + "']");
        performAjaxRequest("/pause_task_activity", {id: id}, function (data) {
            if (data === 'Pause') {
                button.hide();
                $(".playTaskButton[data-id='" + id + "']").show();
            }
        });
    }

</script>
</body>

</html>